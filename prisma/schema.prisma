// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL") // uses connection pooling
  directUrl = env("POSTGRES_URL_NON_POOLING") // uses a direct connection
  // NOTE: When using mysql or sqlserver, uncomment the @db.Text annotations in model Account below
  // Further reading:
  // https://next-auth.js.org/adapters/prisma#create-the-prisma-schema
  // https://www.prisma.io/docs/reference/api-reference/prisma-schema-reference#string
}

// Necessary for auth.js, don't change anything here!!!
model Account {
  id                String  @id @default(cuid())
  userId            String  @unique
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String   @unique
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id               String              @id @default(cuid())
  name             String              @unique
  email            String              @unique
  emailVerified    DateTime?
  image            String
  role             String              @default("guest") //guest, member, staff
  tgc_guild_member Boolean             @default(false)
  accounts         Account[]
  sessions         Session[]
  posts            post[]
  eso              eso[]
  ffxiv            ffxiv[]
  swtor            swtor[]
  staff            staff[]
  post_mod         post_modification[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

// Post tables
model post {
  id          String              @id @default(cuid())
  title       String
  summary     String              @default("None") @db.Text
  content     String              @db.Text
  image       String?             @db.VarChar(255)
  timestamp   DateTime            @default(now()) @db.Timestamptz(6)
  updatedAt   DateTime            @updatedAt @db.Timestamptz(6)
  createdById String
  createdBy   User                @relation(fields: [createdById], references: [id])
  permissions post_permission[]
  mod         post_modification[]
}

model post_permission {
  id           String  @id @default(cuid())
  postId       String  @unique //FK from post
  guild_public Boolean @default(false)
  general      Boolean @default(false) //Game focus
  member       Boolean @default(false)
  eso          Boolean @default(false)
  ffxiv        Boolean @default(false)
  swtor        Boolean @default(false)
  staff        Boolean @default(false) //Staff focus
  officer      Boolean @default(false)
  raid         Boolean @default(false) //Staff focused, but applicable to game
  beginner     Boolean @default(false)
  intermediate Boolean @default(false)
  advanced     Boolean @default(false)
  published    Boolean @default(false)
  type         String //article, build, guide, raid, report, policy
  post         post    @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model post_modification {
  id        String  @id @default(cuid())
  title     String
  summary   String  @default("None") @db.Text
  content   String  @db.Text
  image     String? @default("None") @db.Text
  postId    String  @unique //FK from post
  published String
  modById   String
  modBy     User    @relation(fields: [modById], references: [id])
  postRef   post    @relation(fields: [postId], references: [id], onDelete: Cascade)
}

// Guild role tables
model eso {
  id       String   @id @default(cuid())
  userId   String   @unique //FK from user
  rank     String   @default("none") //member, respected, officer, deputy
  raid     Boolean? @default(false) //Members that are part of a raid team
  raidlead Boolean? @default(false) //Staff/Non-Staff position?, focused on raids
  mentor   Boolean? @default(false) //Staff position, mentor
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model ffxiv {
  id       String   @id @default(cuid())
  userId   String   @unique
  rank     String   @default("none")
  raid     Boolean? @default(false)
  raidlead Boolean? @default(false)
  mentor   Boolean? @default(false)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model swtor {
  id       String   @id @default(cuid())
  userId   String   @unique
  rank     String   @default("none")
  raid     Boolean? @default(false)
  raidlead Boolean? @default(false)
  mentor   Boolean? @default(false)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Staff role table
model staff {
  id             String   @id @default(cuid())
  userId         String   @unique
  admin          Boolean? @default(false) //Developers SPECIFICALLY with website access
  specialist     Boolean? @default(false) //Kind of a catch-all for staff
  representative Boolean? @default(false)
  highcouncil    Boolean? @default(false) //Promote/demote ONLY by GM
  guildmaster    Boolean? @default(false) //All permissions, should not be modifyable by ANYONE else
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// TGC models
// PRIMARY use, staff duty, leaderboard, etc
// PRIMARY use, staff duty, leaderboard, etc
// PRIMARY use, staff duty, leaderboard, etc
// PRIMARY use, staff duty, leaderboard, etc
// PRIMARY use, staff duty, leaderboard, etc

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model discord_user {
  gmember_id        BigInt       @id(map: "idx_16507_primary")
  disc_nickname     String       @db.VarChar(255)
  ingame_name       String       @db.VarChar(255)
  highest_rank_role Int
  staff_duty        staff_duty[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model staff_point_chart {
  task_id          Int          @id(map: "idx_16614_primary")
  task_name        String       @db.VarChar(255)
  point_value      Int
  task_description String?
  staff_duty       staff_duty[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model staff_admin {
  task_uid      Int      @id(map: "idx_16598_primary") @default(autoincrement())
  gmember_id    Int
  duty_type     Int
  timestamp     DateTime @db.Timestamptz(6)
  action_target Int?
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model staff_duty {
  duty_uid          Int               @id(map: "idx_16603_primary") @default(autoincrement())
  gmember_id        BigInt
  duty_type         Int
  timestamp         DateTime          @db.Timestamptz(6)
  target            Int?
  eso_target_user   String?           @db.VarChar
  description       String?
  staff_point_chart staff_point_chart @relation(fields: [duty_type], references: [task_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_duty_to_task")
  discord_user      discord_user      @relation(fields: [gmember_id], references: [gmember_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_duty_to_user")

  @@index([duty_type], map: "idx_16603_fk_duty_to_task")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model staff_point_log {
  uid        Int      @id(map: "idx_16620_primary") @default(autoincrement())
  gmember_id Int
  cnt_points Int
  timestamp  DateTime @db.Timestamptz(6)
}

// Models not currently used in this project
// Models not currently used in this project
// Models not currently used in this project
// Models not currently used in this project
// Models not currently used in this project

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model characters {
  character_uid Int     @id(map: "idx_16468_primary") @default(autoincrement())
  gmember_id    Int
  char_name     String  @db.VarChar(255)
  class_name    String? @db.VarChar(255)
  fact_id       Int?
  game_id       Int
  misc_info     String?
  trial_parse   Int?
}

// BUILD(build_id, title, content, cover_image_path, gmember_id, game_type, summary, created_at)

model audiences {
  audience_id   Int    @id(map: "idx_16408_primary") @default(autoincrement())
  audience_name String @db.VarChar(255)
}

model build_audience_mapping {
  id          Int  @id(map: "idx_16455_primary") @default(autoincrement())
  build_id    Int?
  audience_id Int?
}

model content_access {
  id         Int     @id(map: "idx_16475_primary") @default(autoincrement())
  content_id Int?
  rank_role  String? @db.VarChar(255)
}

model content_types {
  type_id   Int    @id(map: "idx_16480_primary") @default(autoincrement())
  type_name String @db.VarChar(255)
}

model contents {
  content_id Int      @id(map: "idx_16485_primary") @default(autoincrement())
  gmember_id BigInt?
  timestamp  DateTime @default(now()) @db.Timestamptz(6)
  type_id    Int?
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments

// This can be combined with discord_user
model discord_aliases {
  gmember_id      Int
  alias_uid       Int     @id(map: "idx_16491_primary") @default(autoincrement())
  alias_nickname  String? @db.VarChar(255)
  alias_disc_name String? @db.VarChar(255)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model discord_join_leave {
  action_uid Int      @id(map: "idx_16498_primary") @default(autoincrement())
  gmember_id Int
  action     Int
  timestamp  DateTime @db.Timestamptz(6)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model discord_message {
  message_uid Int      @id(map: "idx_16502_primary")
  gmember_id  Int
  channel_id  Int
  content     String
  timestamp   DateTime @db.Timestamptz(6)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model eso_event {
  event_uid       Int      @id(map: "idx_16513_primary") @default(autoincrement())
  gmember_id      Int
  event_type      String   @db.VarChar(255)
  attendee_cnt    Int
  duration        Int
  revenue         Int
  start_timestamp DateTime @db.Timestamptz(6)
  notes           String
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model eso_event_unqiue {
  event_uid    Int
  attendee_num Int @id(map: "idx_16520_primary") @default(autoincrement())
  gmember_id   Int
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model eso_raid {
  gmember_id Int
  trial      Int
  difficulty Int
  clears     Int
  wipes      Int
  duration   Int
  raid_uid   Int @id(map: "idx_16530_primary") @default(autoincrement())
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model eso_raid_unique {
  raid_uid     Int
  attendee_num Int @id(map: "idx_16535_primary") @default(autoincrement())
  gmember_id   Int
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model eso_user {
  gmember_id  Int
  eso_id      String @id(map: "idx_16539_primary") @db.VarChar(255)
  tier_tank   Int?
  tier_healer Int?
  tier_dps    Int?
  parse       Int    @default(1)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model event_signups {
  event_id   Int
  gmember_id Int
  role       Int?
  parse      Int
  signup_uid Int  @id(map: "idx_16544_primary") @default(autoincrement())
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model events {
  event_id     Int      @id(map: "idx_16549_primary") @default(autoincrement())
  event_type   String   @db.VarChar(255)
  date_time    DateTime @db.Timestamptz(6)
  duration     Int
  game         String   @db.VarChar(255)
  details      String
  gmember_id   Int
  repeat_event Boolean?
  req_tank     Int?
  req_heal     Int?
  req_dps      Int?
  req_parse    Int?
}

model guide_audience_mapping {
  id          Int  @id(map: "idx_16562_primary") @default(autoincrement())
  guide_id    Int?
  audience_id Int?
}

model guild_names {
  guild_id   Int    @id(map: "idx_16574_primary")
  guild_name String @db.VarChar(255)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model rank_role_mapping {
  rank_role_id Int     @id(map: "idx_16580_primary")
  rank_role    String? @db.VarChar(60)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model situation_disciplinary {
  action_uid      Int      @id(map: "idx_16584_primary") @default(autoincrement())
  gmember_id      Int
  punish_type     Int
  probation_weeks Int?
  timestamp       DateTime @db.Timestamptz(6)
  report          String?
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model situation_report {
  report_uid Int      @id(map: "idx_16591_primary") @default(autoincrement())
  action_uid Int?
  timestamp  DateTime @db.Timestamptz(6)
  gmember_id Int
  content    String
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model staff_ff_swtor {
  task_uid   Int      @id(map: "idx_16610_primary") @default(autoincrement())
  gmember_id Int
  timestamp  DateTime @db.Timestamptz(6)
  duty_id    Int
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model staff_status_change {
  transaction_id     Int      @id(map: "idx_16625_primary") @default(autoincrement())
  status_update      Int
  training_type      Int?
  trainer_gmember_id Int?
  timestamp          DateTime @db.Timestamptz(6)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model voice_sessions {
  voice_session_id String    @id(map: "idx_16629_primary") @db.VarChar(100)
  gmember_id       String?   @db.VarChar(45)
  channel_id       String?   @db.VarChar(45)
  start_time       DateTime? @db.Timestamptz(6)
  end_time         DateTime? @db.Timestamptz(6)
  duration         Float?
}
